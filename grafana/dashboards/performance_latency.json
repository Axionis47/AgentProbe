{
  "dashboard": {
    "id": null,
    "uid": "agentprobe-performance",
    "title": "AgentProbe - Performance & Latency",
    "tags": ["agentprobe"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "Avg Latency Over Time",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "targets": [
          {
            "rawSql": "SELECT date_trunc('day', c.completed_at) AS time, ROUND(AVG(m.value)::numeric, 2) AS avg_latency_ms FROM metrics m JOIN conversations c ON m.conversation_id = c.id WHERE m.metric_name = 'avg_latency_ms' AND c.completed_at > $__timeFrom() GROUP BY 1 ORDER BY 1",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ms"
          }
        }
      },
      {
        "id": 2,
        "title": "P95 Latency Over Time",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "targets": [
          {
            "rawSql": "SELECT date_trunc('day', c.completed_at) AS time, ROUND(AVG(m.value)::numeric, 2) AS p95_latency_ms FROM metrics m JOIN conversations c ON m.conversation_id = c.id WHERE m.metric_name = 'p95_latency_ms' AND c.completed_at > $__timeFrom() GROUP BY 1 ORDER BY 1",
            "format": "time_series"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ms"
          }
        }
      },
      {
        "id": 3,
        "title": "Token Usage by Agent",
        "type": "barchart",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
        "targets": [
          {
            "rawSql": "SELECT ac.name AS agent, ROUND(AVG(c.total_tokens)::numeric, 0) AS avg_tokens, ROUND(AVG(c.total_input_tokens)::numeric, 0) AS avg_input, ROUND(AVG(c.total_output_tokens)::numeric, 0) AS avg_output FROM conversations c JOIN eval_runs er ON c.eval_run_id = er.id JOIN agent_configs ac ON er.agent_config_id = ac.id WHERE c.status = 'completed' GROUP BY ac.name ORDER BY avg_tokens DESC",
            "format": "table"
          }
        ]
      },
      {
        "id": 4,
        "title": "Output/Input Token Ratio by Agent",
        "type": "barchart",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
        "targets": [
          {
            "rawSql": "SELECT ac.name AS agent, ROUND(AVG(m.value)::numeric, 4) AS avg_ratio FROM metrics m JOIN conversations c ON m.conversation_id = c.id JOIN eval_runs er ON c.eval_run_id = er.id JOIN agent_configs ac ON er.agent_config_id = ac.id WHERE m.metric_name = 'output_input_ratio' GROUP BY ac.name ORDER BY avg_ratio DESC",
            "format": "table"
          }
        ]
      },
      {
        "id": 5,
        "title": "Tokens Per Turn Distribution",
        "type": "histogram",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "targets": [
          {
            "rawSql": "SELECT m.value AS tokens_per_turn FROM metrics m WHERE m.metric_name = 'tokens_per_turn'",
            "format": "table"
          }
        ],
        "fieldConfig": {"defaults": {"custom": {"fillOpacity": 80}}},
        "options": {"bucketSize": 50}
      },
      {
        "id": 6,
        "title": "Latency Distribution",
        "type": "histogram",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
        "targets": [
          {
            "rawSql": "SELECT m.value AS latency_ms FROM metrics m WHERE m.metric_name = 'avg_latency_ms'",
            "format": "table"
          }
        ],
        "fieldConfig": {"defaults": {"unit": "ms", "custom": {"fillOpacity": 80}}},
        "options": {"bucketSize": 100}
      },
      {
        "id": 7,
        "title": "Estimated Cost by Agent (Token Proxy)",
        "type": "barchart",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
        "targets": [
          {
            "rawSql": "SELECT ac.name AS agent, ROUND(SUM(c.total_input_tokens) / 1000000.0 * 3 + SUM(c.total_output_tokens) / 1000000.0 * 15, 2) AS estimated_cost_usd FROM conversations c JOIN eval_runs er ON c.eval_run_id = er.id JOIN agent_configs ac ON er.agent_config_id = ac.id WHERE c.status = 'completed' GROUP BY ac.name ORDER BY estimated_cost_usd DESC",
            "format": "table"
          }
        ],
        "fieldConfig": {"defaults": {"unit": "currencyUSD"}}
      },
      {
        "id": 8,
        "title": "Throughput (Conversations/Day)",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24},
        "targets": [
          {
            "rawSql": "SELECT date_trunc('day', completed_at) AS time, COUNT(*) AS conversations FROM conversations WHERE status = 'completed' AND completed_at > $__timeFrom() GROUP BY 1 ORDER BY 1",
            "format": "time_series"
          }
        ]
      },
      {
        "id": 9,
        "title": "Avg Tokens Per Conversation",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 32},
        "targets": [
          {
            "rawSql": "SELECT ROUND(AVG(total_tokens)::numeric, 0) AS avg_tokens FROM conversations WHERE status = 'completed'",
            "format": "table"
          }
        ]
      },
      {
        "id": 10,
        "title": "Avg Latency Per Conversation",
        "type": "gauge",
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 32},
        "targets": [
          {
            "rawSql": "SELECT ROUND(AVG(total_latency_ms)::numeric, 0) AS avg_latency FROM conversations WHERE status = 'completed'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "ms",
            "min": 0,
            "max": 10000,
            "thresholds": {
              "steps": [
                {"color": "green", "value": 0},
                {"color": "yellow", "value": 3000},
                {"color": "red", "value": 8000}
              ]
            }
          }
        }
      },
      {
        "id": 11,
        "title": "Tool Call Success Rate",
        "type": "gauge",
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 32},
        "targets": [
          {
            "rawSql": "SELECT ROUND(AVG(value)::numeric, 4) AS success_rate FROM metrics WHERE metric_name = 'tool_success_rate'",
            "format": "table"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "min": 0,
            "max": 1,
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "yellow", "value": 0.7},
                {"color": "green", "value": 0.9}
              ]
            }
          }
        }
      },
      {
        "id": 12,
        "title": "Avg Turns to Resolution",
        "type": "stat",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 32},
        "targets": [
          {
            "rawSql": "SELECT ROUND(AVG(value)::numeric, 1) AS avg_turns FROM metrics WHERE metric_name = 'turns_to_resolution'",
            "format": "table"
          }
        ]
      }
    ],
    "schemaVersion": 39,
    "version": 1
  }
}
